From 229b3e9ace11629df5f48666d1341c9334f4d7cc Mon Sep 17 00:00:00 2001
From: Lans Zhang <jia.zhang@windriver.com>
Date: Tue, 13 Jun 2017 14:57:54 +0800
Subject: [PATCH] Fix build failure with glib-2.0

Signed-off-by: Lans Zhang <jia.zhang@windriver.com>
---
 Makefile.am  | 4 +++-
 configure.ac | 1 +
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/Makefile.am b/Makefile.am
index a3c43f8..45837ef 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -35,7 +35,9 @@ ACLOCAL_AMFLAGS = -I m4
 INCLUDE_DIRS = -I$(srcdir)/src -I$(srcdir)/lib
 LIB_COMMON := lib/libcommon.a
 
-AM_CFLAGS    := $(INCLUDE_DIRS) $(TPM20_TSS_CFLAGS) $(EXTRA_CFLAGS) $(TCTI_TABRMD_CFLAGS)
+AM_CFLAGS    := $(INCLUDE_DIRS) \
+    $(GLIB_CFLAGS) \
+    $(TPM20_TSS_CFLAGS) $(EXTRA_CFLAGS) $(TCTI_TABRMD_CFLAGS)
 AM_LDFLAGS   := $(EXTRA_LDFLAGS)
 
 LDADD = $(LIB_COMMON) $(TPM20_TSS_LIBS) $(TCTI_SOCK_LIBS) $(TCTI_DEV_LIBS) $(TCTI_TABRMD_LIBS)
diff --git a/configure.ac b/configure.ac
index ce781ea..08fa81c 100644
--- a/configure.ac
+++ b/configure.ac
@@ -6,6 +6,7 @@ LT_INIT
 AM_INIT_AUTOMAKE([foreign
                   subdir-objects])
 AC_CONFIG_FILES([Makefile])
+PKG_CHECK_MODULES([GLIB], [glib-2.0])
 PKG_CHECK_MODULES([SAPI],[sapi])
 # disable libtcti-device selectively (enabled by default)
 AC_ARG_WITH(
-- 
2.7.5

